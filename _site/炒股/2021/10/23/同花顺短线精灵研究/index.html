<!DOCTYPE html>
<html>


    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
<title>同花顺短线精灵研究</title>
<meta name="description" content="A blog about programming and network security">

<link rel="profile" href="https://gmpg.org/xfn/11" />
<link rel="stylesheet" href="/css/my_code.css">
<!-- below font-awesome.css can not be replaced by local file,error will occur -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">

<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet">

<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">

<!-- Favicons generated at https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- 下面这句是添加在线中文字体:文泉驿等宽正黑 -->
<!-- <script type="text/javascript" src="//cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script> -->







<!-- add zoom.js --> 
<link href="/css/zoom.css" rel="stylesheet">
<script src="/js/jquery-1.11.0.min.js"></script>
<script src="/js/zoom.js"></script>
<script src="/js/transition.js"></script>

</head>


    <body>

    <nav id="my-menu">
  <div>
    <p style="font-family: 'Great Vibes', cursive;">quanyechavshuo</p>


    
    <center style="margin-top:180%">
    <font color="red" align="center"><i class="fa fa-link" aria-hidden="true"></i><a href="../../../../../bookmarks.html"><font color="red"> link</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-key" aria-hidden="true"></i><a href="../../../../../book.html" target="_top"><font color="red"> book</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-music" aria-hidden="true"></i><a href="../../../../../jquery-jplayer/index.html" target="_top"><font color="red"> music</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-caret-square-o-right" aria-hidden="true"></i><a href="../../../../../mv.html" target="_top"><font color="red"> movie</font></a></font>
    </center>
    <p class="links">
  <a href="https://www.twitter.com/quanyechavshuo" target="_new"><i class="fa fa-twitter"></i></a>
  <a href="https://github.com/3xp10it" target="_new"><i class="fa fa-github-alt"></i></a>
  <a href="/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>



    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="https://schema.org/Article" class="col-md-12 article">
      

      <h1 class="header" itemprop="name">同花顺短线精灵研究</h1>

      <div class="author">
        <small><i>
          
          on <span itemprop="datePublished" content="2014-08-28">October 23, 2021</span>
           under 炒股
        </i></small>
      </div>

      <div class="read-time">
        <small>
          18 minute read
        </small>
      </div>

      <div class="content-panel content">

        

        <span itemprop="articleBody"><h3 id="0x0-about">0x0 About</h3>

<p>记录同花顺短线精灵功能的研究,目标:获得同花顺短线精灵推送数据</p>

<h3 id="0x1-macos端">0x1 macOS端</h3>

<p>macOS下由于类名和函数名可见,研究macOS下的同花顺比windows下的简单,经过ida反编译和人工分析后得出目标函数为:<code class="highlighter-rouge">ShortTermWizardViewController['- insertPushData:inArray:']</code>,可构建如下脚本获取目标数据</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import pdb
import frida
import sys
import requests
from exp10it import say

with open("config.ini","r",encoding="utf8") as f:
    config_dict=eval(f.read())
MAIN_SERVER_IP=config_dict['main_server'].split(":")[0]
def on_message(message, data):
    if message['type'] == 'send':
        #stock_code=message['payload']['5'][4:]
        #action=message['payload']['61']
        if '封涨停板'==message['payload']['result']['61']:
            stock_code=message['payload']['result']['5'][4:]
            requests.get("http://"+MAIN_SERVER_IP+":8888/ths_info_fengban?stock_code="+stock_code+"&amp;callback=lala")
            print(message)
    elif message['type'] == 'error':
        #print("[!] " + message['stack'])
        pass
    else:
        print(message)

def main(target_process):
    session = frida.attach(target_process)
    script = session.create_script("""
        var insertPushData= ObjC.classes.ShortTermWizardViewController['- insertPushData:inArray:']
        Interceptor.attach(insertPushData.implementation, {
          onEnter: function (args) {
            var array = new ObjC.Object(args[2]);
            var count = array.count().valueOf();
            for (var i = 0; i !== count; i++) {
            var element = array.objectAtIndex_(i);
            console.log(element)
            var dict = new ObjC.Object(element);
            var item_dict={}
            var enumerator = dict.keyEnumerator();
            var key;
            while ((key = enumerator.nextObject()) !== null) {
              var value = dict.objectForKey_(key);
              item_dict[key]=String(ObjC.classes.NSString.stringWithString_(value))
            }
            send({'result':item_dict})
            dict=null
            }

          }
        });
    """)
    script.on("message", on_message)
    script.load()
    while True:
        import time
        time.sleep(36000)
    #print("[!] Ctrl+D or Ctrl+Z to detach from instrumented program.\n\n")
    #sys.stdin.read()
    #session.detach()


if __name__ == "__main__":
    import psutil
    pids = psutil.pids()
    pid_name_dict={}
    for pid in pids:
        p = psutil.Process(pid)
        name=p.name()
        pid_name_dict[name]=pid
    t_pid=pid_name_dict["同花顺"]
    main(t_pid)
</code></pre>
</div>

<h3 id="0x2-windows端">0x2 windows端</h3>

<p>由于macOS下同花顺短线精灵的功能比较少,有很多其他异动无法配置接收,说明macOS下的同花顺和windows下的同花顺对应的服务器不是同一套,level2帐户可以同时在macOS的同花顺和windows的同花顺一起登录而不被踢下线也证实了这点.怀疑windwos下的推送可能更快,至少windows下有更多异动可以接收,于是研究windows下的同花顺短线精灵.</p>

<h4 id="0xa-分析socket">0xa 分析socket</h4>

<p>通过proxifier+charles分析出同花顺短线精灵的网络传输方法是socket连接传输,同花顺客户端在启动后会连接3个短线精灵服务器(如下为某次启动后的3个目标地址,实际每次启动同花顺后的3个短线精灵服务器可能不一样),但只会和一个服务器进行数据交互(猜测是地理位置就近选择),人工写代码连接目标短线精灵服务器时可设置为抓包到的任何一个.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>('121.52.252.79',9601)
('121.52.252.103',9601)
('183.129.141.37',9601)
</code></pre>
</div>

<p>经抓socket包发现短线精灵登录数据包含Mac64和Passport64两个关键字段,而每次登录时同一个用户的这2个字段都是不变的,于是可通过直接创建socket连接并发登录数据来直接连接同花顺短线精灵服务器,最终构建代码如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import time
import threading
import socket
import base64
import pdb
import snappy
login_hex_str=b'FDFDFDFD3030303030386638094109007A685F434E2E47424BEA0841736B3D6C6F67696E0A432D56657273696F6E3D453032382E39302E35312E303030300A566572696679547970653D340A4D616336343D48737A3535503269323669685755774C6A737A353550326931387A3535503269324D37353550326931773D3D0A432D537570706F7274507573685665723D312E300A432D537570526571446174615665723D6871362E300A432D53757050757368446174615665723D6871362E300A50617373706F727436343D4B51594767414265734E314D6356725A34785037396638706B64745261777A6269454B5764324A6D7349476B473037596F505A487245764B6F5261353452394C5A516966546F4D544E377550757275786C704C38386C576D4C45377776372F685551764E69394630616530445474304274387A4D675A6B6558736F4B34386E392F79786C30336A316D794948594B48444B64504B5468654E53575170484A5A6D794B384A363736766575766D5A615A5253584E705A32356F62334E305062724C304D4C4937627A2B577A63775851304B63326C6E626D5268644755394D6A41794D5445774D5451774D41304B63326C6E626E5A6862476C6B505449774D6A45784D4449774D44414E436D466A59323931626E513964484A685A47553062476C325A51304B64584E6C636D4E7359584E7A50544D774D444179445170786333567A5A584A6A6247467A637A30774451707459586876626D7870626D55394D51304B62584E6E5932396B5A5430314D4449784F4445304F44634E436D6C745A576B394D44557A4D5452454E6A55324D4441784F555A44526B59794E7A4A434D554D354D4452454F5451774E7A514E436D5A31626D52705A44304E436B316663584D394F4441774451704E59584A725A5852446232526C505445324F7A4D794F7A6B324F7A45304E4473784E7A59374D5445794F7A67344F7A45794F4473304F4473784E6A67374D5467304F7A49774D4473794D5459374D6A4D794F7A45794D4473314E6A73324E4473344D4473784E6A41374451704E58336C35596A304E436D526C634852705A44304E436B317A5A31395663325679544756325A57773944517049595778305054414E436E4A68626D73394451703163475268644755394451703163325679615751394E446B794D5467784E4467334451707A615751394E5377784C4451774F7A59734D5377304D4473334C4445784D5445784D5445784D5445784D4377304D4473344C4445784D5445774D5445784D4441774D4445784D5445784D4441784D4441784D4441784D4441774D4441774C4451774F7A4D7A4C4441774D4445774D4441774D4441774D4377794E6A59374D7A59734D5441774D5445784D5445774D4441774D5445774D4445774D5445784D5445784C4449324E6A73304E6977774D4441774D5445784D5445774D4441774D4445784D5445784D5445784D5445734D6A59324F7A55784C4445784D4441774D4441774D4441774D4441774D4441734D6A59324F7A55344C4441774D4441774D4441774D4441774D4441774D4441784C4449324E6A73334F4377784C4449324E6A73344E7977774D4441774D4441774D4441774D4441774D4441774D4441774D5441774D4441734D6A59324F7A51304C4445784C4451774F7A45734D5441784C4451774F7A49734D5377304D44737A4C4445734E4441374D5441794C4445734E4441374451707A5A57786C59335139654763754D544271635774684C6D4E766253356A626A6F344D44724E724C756F793750526F626E4A445170795A5764306157316C505449774D546B744D4463744D4463674D5463364D7A594E436E527965584E705A44304E436D786C646D56734D6A30784E6A737A4D6A73304F41304B63484A76505555774D67304B646D5679505467754F5441754E5445754D4441774D41304B59584A6C5954304E436D687858334E776247467A614430794D7A41354451706F6356397362326470626C39735A575A3058334270597A30794D7A45354451706F635639745A57353150544D7A4F444D4E436D687858334E6F62334A305933563058323568625755397A617937714D757A4451706F6356397362326470626C39735A575A305833427059313931636D77396148523063446F764C334E6B4C6A4577616E46725953356A623230755932344E436D687858336470626D527664313930615852735A54334E724C756F79374E4D5A585A6C6243307979653632794C66577A7662507463327A445170696247396A617A30324D5451304D5330324D5451304E4473324D5451334D6930324D5451334E7A73324D5451334F4473324D5451334F5473324D5455794F4473324D5451344D4473324D5451354D4473324D5451354E4473324D5451354E5473324D5451354E6A73324D5455774F4473324D5455774F5473324D5455784D4473324D5455794D4473324D5451334D5473324D5455794D5473324D5455794D6A73324D5455794E5473324D5455794E6A73324D5455794E7A73324D5455794E4473324D5455794F51304B6332566A64584A7064476C6C637A334E724C756F7937504E73394B37734F594E436D4E736157567564476C7750544D334D544D31596A4E6B4D7A4E684D51304B625739755A586C6663325679646D56795054416A6148523063446F764C336433647934784D47707861324575593239744C6D4E754C326C684C3370706343386A4D534E6F644852774F693876643364334C6A4577616E46725953356A623230755932347661574576656D6C774C794D7949326830644841364C793933643363754D544271635774684C6D4E766253356A626939705953393661584176497A4D6A6148523063446F764C336433647934784D47707861324575593239744C6D4E754C326C684C3370706343386A4D54417749326830644841364C793933643363754D544271635774684C6D4E766253356A626939705953393661584176497A45774D534E6F644852774F693876643364334C6A4577616E46725953356A623230755932347661574576656D6C774C794D4E436E566859334E6664584E6C636C396D6247466E5054457344517031633256795A6D78685A7A3079445170696157356B50544D4E436E4E725057527557545577626C564F4451707A646A30784D6A4D784F5455304D54494E4367413D0A'
dxjl_client=socket.socket()
dxjl_client.connect(('121.52.252.79',9601))
#dxjl_client.connect(('121.52.252.103',9601))
#dxjl_client.connect(('183.129.141.37',9601))

def handle_one_message_bytes(one_message_bytes):
    if len(one_message_bytes)==73:
    #b'instid=28573696\nmethod=subrealorder\nmarket=16\nrettype=hqfile\nerrorcode=0\n'
        return
    elif one_message_bytes[15:26]==b'Reply=login':
        print("login succeed")
    else:
        #处理一个正常的包含内容的消息
        print(one_message_bytes)
        print("====================")
        #return
        #pdb.set_trace()
        i=0
        while True:
            try:
                uncompressed = snappy.stream_decompress(one_message_bytes[i:])
                #content_string=snappy.decompress(one_message_bytes[i:-2]).decode(encoding="utf8",errors="ignore")
                if uncompressed!=b'':
                    print(666)
                    pdb.set_trace()
            except Exception as e:
                pass
                #if 'Error while decompressing: invalid input' in str(e):
                #    pass
                #else:
                #    print(e)
                #    pdb.set_trace()
                #    #print(e)
                
            i+=1
            if i&gt;len(one_message_bytes)-10:
                print("over")
                break

        
    

def get_one_message_bytes_from_target_bytes_data_with_fdfdfdfd_start(data):
    if data[:4]!=b'\xfd\xfd\xfd\xfd':
        print('error')
        print(data)
        pdb.set_trace()
    length=int(data[4:12].decode(),16)
    print(length)
    if len(data[13:])&lt;length:
        #这次没接收完,下个包还是当前消息的内容
        one_message_bytes=data[13:]
        left_want_length=length-len(data[13:])
        while True:
            n_data=dxjl_client.recv(1024)
            if len(n_data)&gt;=left_want_length:
                #接收完这个消息的所有内容了,可能还有下个消息的部分内容
                one_message_bytes+=n_data[:left_want_length]
                left_dontwant_bytes=n_data[left_want_length:]
                return one_message_bytes,left_dontwant_bytes
            else:
                #没接收完这个消息的所有内容,继续接收
                one_message_bytes+=n_data
                left_want_length-=len(n_data)
    elif len(data[13:])==length:
        #这次刚好接收完
        one_message_bytes=data[13:]
        return one_message_bytes,b''
        pass
    else:
        #这次接收完,并且还有不想要的下个消息的内容
        one_message_bytes=data[13:13+length]
        left_dontwant_bytes=data[13+length:]
        return one_message_bytes,left_dontwant_bytes

                
                
                
def handle_message(dxjl_client):
    left_dontwant_bytes=dxjl_client.recv(1024)
    print(left_dontwant_bytes)
    while True:
        if left_dontwant_bytes==b'':
            left_dontwant_bytes=dxjl_client.recv(1024)
            print(left_dontwant_bytes)
        one_message_bytes,left_dontwant_bytes=get_one_message_bytes_from_target_bytes_data_with_fdfdfdfd_start(left_dontwant_bytes)
        handle_one_message_bytes(one_message_bytes)

        
t=threading.Thread(target=handle_message,args=(dxjl_client,))
t.start()

dxjl_client.send(base64.b16decode(login_hex_str))
time.sleep(3)
heartbeat_str=b'FDFDFDFD30303030303030'+b'34'+b'09'+b'00000000'
def get_bytes_from_hexline(hexline_str):
    return hexline_str.replace(" ","").upper().encode()

dingyue1_str=b'FDFDFDFD303030303030'+b'3565'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 35 37 33 36 39 36 0a 6d 65 74 68 6f 64 3d 73 75 62 72 65 61 6c 6f 72 64 65 72 0a 61 63 74 69 6f 6e 3d 61 64 64 0a 6d 61 72 6b 65 74 3d 31 36 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
dingyue2_str=b'FDFDFDFD303030303030'+b'3565'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 36 33 39 32 33 32 0a 6d 65 74 68 6f 64 3d 73 75 62 72 65 61 6c 6f 72 64 65 72 0a 61 63 74 69 6f 6e 3d 61 64 64 0a 6d 61 72 6b 65 74 3d 33 32 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
dingyue3_str=b'FDFDFDFD303030303030'+b'3565'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 37 30 34 37 36 38 0a 6d 65 74 68 6f 64 3d 73 75 62 72 65 61 6c 6f 72 64 65 72 0a 61 63 74 69 6f 6e 3d 61 64 64 0a 6d 61 72 6b 65 74 3d 34 38 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query1_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 37 37 30 33 30 34 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 31 36 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query2_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 38 33 35 38 34 30 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 33 32 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query3_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 39 30 31 33 37 36 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 34 38 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query4_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 38 39 36 36 39 31 32 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 31 36 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query5_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 39 30 33 32 34 34 38 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 33 32 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')
query5_str=b'FDFDFDFD303030303030'+b'6464'+b'09'+get_bytes_from_hexline('69 6e 73 74 69 64 3d 32 39 30 39 37 39 38 34 0a 6d 65 74 68 6f 64 3d 71 75 72 65 61 6c 6f 72 64 65 72 0a 72 65 71 74 79 70 65 3d 34 0a 6d 61 78 63 6f 75 6e 74 3d 38 30 0a 64 61 74 61 74 79 70 65 3d 31 30 37 34 32 36 39 34 30 30 2c 31 30 37 34 32 36 39 34 31 30 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 31 7b 31 39 5b 35 30 30 30 30 30 30 7e 2d 5d 7d 2c 31 30 37 34 32 36 39 34 31 32 2c 31 30 37 34 32 36 39 34 32 32 2c 31 30 37 34 32 36 39 34 30 38 2c 31 30 37 34 32 36 39 34 30 39 2c 0a 6d 61 72 6b 65 74 3d 34 38 0a 61 63 63 65 70 74 5f 7a 69 70 74 79 70 65 3d 73 6e 61 70 70 79 0a 72 65 74 74 79 70 65 3d 68 71 66 69 6c 65 00')


def dingyue_and_query(dxjl_client):
    dxjl_client.send(base64.b16decode(heartbeat_str))
    dxjl_client.send(base64.b16decode(dingyue1_str))
    #time.sleep(3)
    dxjl_client.send(base64.b16decode(dingyue2_str))
    #time.sleep(3)
    dxjl_client.send(base64.b16decode(dingyue3_str))
    #time.sleep(3)
    #dxjl_client.send(base64.b16decode(query1_str))
    dxjl_client.send(base64.b16decode(query2_str))
    #dxjl_client.send(base64.b16decode(query3_str))
    #dxjl_client.send(base64.b16decode(query4_str))
    #dxjl_client.send(base64.b16decode(query5_str))
    
def keep_dxjl_heartbeat(dxjl_client):
    dingyue_and_query(dxjl_client)
    while True:
        time.sleep(3)
        #print("send heartbeat")
        dxjl_client.send(base64.b16decode(heartbeat_str))

t=threading.Thread(target=keep_dxjl_heartbeat,args=(dxjl_client,))
t.start()


while True:
    time.sleep(30)
</code></pre>
</div>

<p>其中的dingyue1_str,dingyue2_str,dingyue3_str为订阅异动推送发起的请求数据,query_str为初始化时查询初始化显示异动数据时的请求数据,服务器返回给客户端的数据应该使用了snappy压缩,但又不是直接的snappy压缩(无法使用snappy算法解压成功,应该是有同花顺自己设计的文件格式,目前不知道怎样解码),最终想直接连接socket来获取数据卡在了解压服务器返回的数据这一步.</p>

<h4 id="0xb-脱壳">0xb 脱壳</h4>

<p>socket数据无法解密,只好尝试hook关键函数来获取短线精灵异动数据.运气比较好,windows下的同花顺只加了upx壳,可简单通过网上下载的upx unpacker一键脱壳</p>

<h4 id="0xc-分析目标函数">0xc 分析目标函数</h4>

<p>通过cheat engine的ultimap功能找到关键的目标函数,需要在盘后进行,过程如下:</p>

<p>1.打开脱壳后的同花顺并打开短线精灵,清空自选股,只加一支股票到自选股中,点击短线精灵的”自”,看该股票有几个异动,显示”自”有4个异动,对应目标函数运行了4次.点击短线精灵上的”板”,这时对应的数据返回为空,因为一般情况下没有板块的异动推送,对应目标函数没有运行.</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl1.png" data-action="zoom" /></p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl2.png" data-action="zoom" /></p>

<p>2.关闭同花顺并重新打开同花顺和短线精灵,由于上次短线精灵点击了”板”,这次打开后短线精灵默认还会留在”板”的窗口,也即对应客户端没有处理异动数据,没有运行关键函数.</p>

<p>3.打开cheat engine附加到同花顺进程,打开memory view,打开tool里面的ultimap(不是ultimap2),点击start,点击code did not get executed,过5秒左右后进行如下重复操作:
<code class="highlighter-rouge">点击短线精灵上的"自",再点击cheat engine中ultimap的code has been executed,再点击短线精灵的"板",再点击ultimap的code did not get executed</code>,一共进行6次该操作,由于每次切换到短线精灵的”自”上后目标函数会运行4次,所以6次操作后对应目标函数运行了4*6=24次,ultimap中统计出运行过24次的函数列表如下图.</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/ultimap.png" data-action="zoom" /></p>

<p>4.经过ida和cheat engine的静态分析和动态调试,确认目标函数是<code class="highlighter-rouge">hexin.exe+92FDF0</code>,调用代码为<code class="highlighter-rouge">hexin.exe+93134D - E8 9EEAFFFF    - call hexin.exe+92FDF0</code>,如下图:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce1.png" data-action="zoom" /></p>

<p>定义<code class="highlighter-rouge">hexin.exe+93134D</code>为关键位置1,定义函数<code class="highlighter-rouge">hexin.exe+92FDF0</code>为关键函数1.关键位置1的下一行汇编代码的地址是<code class="highlighter-rouge">hexin.exe+931352</code>,定义该地址为关键位置1-1.</p>

<p>关键函数1经ida反编译如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>void __thiscall sub_D2FDF0(char *this, int a2, int a3, COLORREF color, int a5, int a6, int a7, int a8)
{
  char *v8; // ebx
  volatile LONG *v9; // eax
  volatile LONG *v10; // ecx
  int v11; // eax
  int v12; // eax
  int v13; // esi
  _DWORD **v14; // edi
  int v15; // ebx
  int v16; // esi
  char *v17; // eax
  char *v18; // ecx
  int v19; // ebx
  int v20; // esi
  int v21; // ebx
  int *v22; // eax
  volatile LONG *v23; // esi
  char *v24; // eax
  int v25; // eax
  int v26; // esi
  int v27; // eax
  int v28; // esi
  int v29; // eax
  int v30; // ST0C_4
  int v31; // edx
  int v32; // ecx
  int v33; // eax
  int v34; // ecx
  int v35; // edx
  int v36; // eax
  int v37; // ecx
  int v38; // eax
  _DWORD *v39; // ecx
  char *v40; // edx
  int v41; // ST0C_4
  int v42; // ST0C_4
  __int16 v43; // [esp-4h] [ebp-6Ch]
  double v44; // [esp+10h] [ebp-58h]
  int v45; // [esp+18h] [ebp-50h]
  int v46; // [esp+1Ch] [ebp-4Ch]
  int v47; // [esp+20h] [ebp-48h]
  int v48; // [esp+24h] [ebp-44h]
  int v49; // [esp+28h] [ebp-40h]
  int v50; // [esp+2Ch] [ebp-3Ch]
  char v51; // [esp+30h] [ebp-38h]
  char v52; // [esp+38h] [ebp-30h]
  char v53; // [esp+40h] [ebp-28h]
  int v54; // [esp+48h] [ebp-20h]
  volatile LONG *v55; // [esp+4Ch] [ebp-1Ch]
  char v56; // [esp+50h] [ebp-18h]
  int v57; // [esp+54h] [ebp-14h]
  char *v58; // [esp+58h] [ebp-10h]
  int v59; // [esp+64h] [ebp-4h]
  int v60; // [esp+70h] [ebp+8h]
  COLORREF colora; // [esp+78h] [ebp+10h]
  COLORREF colorb; // [esp+78h] [ebp+10h]
  COLORREF colorc; // [esp+78h] [ebp+10h]
  int v64; // [esp+80h] [ebp+18h]

  v8 = this;
  v58 = this;
  v9 = (volatile LONG *)sub_D65190(this + 2672);
  v10 = v9;
  v11 = *((_DWORD *)v9 + 1) - *v9;
  v55 = v10;
  v12 = v11 &gt;&gt; 3;
  if ( !v12 )
    return;
  v13 = a2;
  if ( a2 &lt; 0 || a2 &gt;= v12 )
    return;
  v14 = (_DWORD **)color;
  if ( a2 == *(_DWORD *)(*((_DWORD *)v8 + 65) + 172) )
  {
    colora = sub_A92710(color);
    if ( a6 &gt; 0 )
    {
      v15 = a5;
      v16 = a6;
      do
      {
        if ( sub_4B9250() )
          sub_A934A0(v15, (COLORREF)&amp;loc_FFCD90 + 3);
        else
          sub_A934A0(v15, 0x800041u);
        v15 += 32;
        --v16;
      }
      while ( v16 );
      v13 = a2;
      v8 = v58;
    }
    sub_A91510(v14, colora);
  }
  v17 = (char *)sub_B82DD0(v8);
  v18 = v17;
  v58 = v17;
  if ( v17 &amp;&amp; (*(_DWORD *)(v17 + 150) &amp; 0xF00) == 1792 )
  {
    colorb = sub_4B9AF0(0);
    if ( !(v13 % 2) )
      colorb = sub_4B9AF0(1);
    if ( v13 == *(_DWORD *)(*((_DWORD *)v8 + 65) + 172) )
      colorb = sub_4B9AF0(2);
    v57 = sub_A92710(v14);
    if ( a6 &gt; 0 )
    {
      v19 = a5;
      v20 = a6;
      do
      {
        sub_A934A0(v19, colorb);
        v19 += 32;
        --v20;
      }
      while ( v20 );
      v13 = a2;
    }
    sub_A91510(v14, v57);
    v18 = v58;
  }
  v21 = *(_DWORD *)(*v55 + 8 * v13);
  v22 = (int *)(*v55 + 8 * v13);
  v54 = *v22;
  v23 = (volatile LONG *)v22[1];
  v55 = v23;
  if ( v23 )
  {
    InterlockedIncrement(v23);
    v18 = v58;
  }
  v59 = 0;
  if ( v21 )
  {
    v24 = *(char **)(v21 + 32);
    colorc = *(_DWORD *)(v21 + 32);
    if ( !v18 || (*(_DWORD *)(v18 + 150) &amp; 0xF00) != 1792 )
      goto LABEL_38;
    if ( v24 == (char *)3289855 || v24 == (char *)1179878 || v24 == (char *)&amp;loc_4030FF )
    {
      v25 = sub_4B9AF0(6);
    }
    else
    {
      if ( v24 != (char *)58880 &amp;&amp; v24 != (_BYTE *)&amp;loc_4498FC + 4 &amp;&amp; v24 != (_BYTE *)&amp;loc_66D117 + 1 )
        goto LABEL_38;
      v25 = sub_4B9AF0(7);
    }
    *(_DWORD *)(v21 + 32) = v25;
LABEL_38:
    v26 = (*(_DWORD *)(a3 + 4) - *(_DWORD *)a3) &gt;&gt; 2;
    v64 = (*(_DWORD *)(a3 + 4) - *(_DWORD *)a3) &gt;&gt; 2;
    sub_A91500(v14, 1);
    v27 = 0;
    v60 = 0;
    if ( v26 &gt; 0 )
    {
      v28 = a5;
      do
      {
        v29 = *(_DWORD *)(*(_DWORD *)a3 + 4 * v27);
        if ( v29 )
        {
          switch ( *(_DWORD *)(v29 + 12) )
          {
            case 1:
              v30 = *(_DWORD *)(v21 + 32);
              sub_A91520(v14);
              v31 = *(_DWORD *)(v28 + 8);
              v32 = *(_DWORD *)(v28 + 4);
              LODWORD(v44) = *(_DWORD *)v28;
              v33 = *(_DWORD *)(v28 + 12);
              HIDWORD(v44) = v32;
              v34 = *(_DWORD *)(v28 + 16);
              v45 = v31;
              v35 = *(_DWORD *)(v28 + 20);
              v46 = v33;
              v44 = v44 + 2.0;
              v36 = *(_DWORD *)(v28 + 24);
              v47 = v34;
              v37 = *(_DWORD *)(v28 + 28);
              v48 = v35;
              v49 = v36;
              v50 = v37;
              sub_A95FA0(v14, (double *)&amp;v56, (_DWORD *)(v21 + 8), &amp;v44, 36);
              break;
            case 2:
              if ( sub_D6A470((_BYTE *)v21) )
              {
                if ( v58 &amp;&amp; (*(_DWORD *)(v58 + 150) &amp; 0xF00) == 1792 )
                  sub_4B9AF0(9);
                else
                  sub_4B4C80(30059, 0);
              }
              else
              {
                v38 = *(_DWORD *)(v21 + 32);
              }
              sub_A91520(v14);
              if ( sub_4B9C60(*(void **)v21, 0, 0, 2) != -1 )
                sub_A91520(v14);
              v43 = -32732;
              v39 = (_DWORD *)(v21 + 4);
              v40 = &amp;v53;
              goto LABEL_54;
            case 3:
              v41 = *(_DWORD *)(v21 + 32);
              sub_A91520(v14);
              v43 = 36;
              v39 = (_DWORD *)(v21 + 12);
              v40 = &amp;v52;
              goto LABEL_54;
            case 4:
              v42 = *(_DWORD *)(v21 + 32);
              sub_A91520(v14);
              v43 = 38;
              v39 = (_DWORD *)(v21 + 16);
              v40 = &amp;v51;
LABEL_54:
              sub_A95FA0(v14, (double *)v40, v39, (double *)v28, v43);// /hexin.exe+930133
              break;
            default:
              break;
          }
        }
        v27 = v60 + 1;
        v28 += 32;
        v60 = v27;
      }
      while ( v27 &lt; v64 );
    }
    v23 = v55;
    *(_DWORD *)(v21 + 32) = colorc;
  }
  v59 = -1;
  if ( v23 &amp;&amp; !InterlockedDecrement(v23) )
  {
    if ( v21 )
    {
      sub_D2F030(v21);
      operator delete((void *)v21);
    }
    operator delete((void *)v23);
  }
}
</code></pre>
</div>

<p>thiscall对应的是对象的私有函数调用,这个函数应该是图形对象调用的.动态调试时由短线精灵的”板”切换到”自”对应该函数运行了4次(通过打断点验证),经frida hook发现异动数据不在这个函数的参数里面,说明异动数据是由该函数的参数”变形”得来的,目前不知道是怎样”变形”出来的,尝试通过cheat engine的内存访问断点来找到关键函数1中更进一步的内部子函数.</p>

<p>5.点击短线精灵的”自”,第一条异动数据是<code class="highlighter-rouge">10:58:42    鸿达兴业    区间放量跌    6.33倍</code>,记住这里的<code class="highlighter-rouge">10:58:42</code>字符串.点击短线精灵的”板”,关闭同花顺和短线精灵,重新打开同花顺和短线精灵,打开cheat engine附加到同花顺进程,在内存区搜索内存内容<code class="highlighter-rouge">10:58:42</code>,现在搜索不到(短线精灵打开的初始状态是”板”,对应没有”自”里面的异动数据),在
关键位置1(<code class="highlighter-rouge">hexin.exe+93134D</code>)处的<code class="highlighter-rouge">call hexin.exe+92FdF0</code>下断点,点击短线精灵的”自”,触发了该断点,在cheat engine的内存中搜索<code class="highlighter-rouge">10:58:42</code>,现在能搜到了,而且它还没有显示在短线精灵上,在该数据内存地址上右键设置访问断点,如下图:</p>

<p><img src="https://github.com/3xp10it/pic/raw/master/dxjl_ce_memory_search.png" data-action="zoom" /></p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce2.png" data-action="zoom" /></p>

<p>现在cheat engine中断到关键位置1处,点击Run,中断到系统函数中,如下图:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce3.png" data-action="zoom" /></p>

<p>栈里面有关键位置1-1,定义栈里面的几个值分别为关键位置4-1,关键位置3-1,关键位置2-1,说明目前的函数运行流程是关键位置1(call hexin.exe+92FDF0) -&gt; 关键位置2 -&gt; 关键位置3 -&gt; 关键位置4 -&gt; USER32.DrawTextA,看看当前系统函数的上一层函数是什么,在cheat engine中双击栈中的关键位置4-1,汇编窗口自动跳转到对应位置,对应<code class="highlighter-rouge">hexin.exe+142BE7</code>为关键位置4,如下图:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce4.png" data-action="zoom" /></p>

<p>关键位置4在ida中显示如下:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce5.png" data-action="zoom" /></p>

<p>在cheat engine中双击栈中的关键位置3-1,汇编窗口自动跳转到对应位置,对应<code class="highlighter-rouge">hexin.exe+69607C</code>为关键位置3,如下图:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce6.png" data-action="zoom" /></p>

<p>关键位置3在ida中显示如下:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce8.png" data-action="zoom" /></p>

<p>在cheat engine中双击栈中的关键位置2-1,汇编窗口自动跳转到对应位置,对应<code class="highlighter-rouge">hexin.exe+930133</code>为关键位置2,如下图:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce7.png" data-action="zoom" /></p>

<p>关键位置2在ida中显示如下:</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_ce9.png" data-action="zoom" /></p>

<p>在ida中看出,关键位置2已经在关键位置1调用的关键函数1的内部了.也即调用流程如下:
关键位置1调用关键函数1,关键函数1内部有关键位置2,关键位置2调用关键函数2,关键函数2中有关键位置3,关键位置3调用关键函数3,关键函数3中有关键位置4,关键位置4调用USER32.DrawTextA来显示短线精灵异动数据.在ida中看出关键函数2有5个参数,经过手动尝试访问这5个参数的内存内容,发现异动数据在关键函数2的参数v39里面,*[v39]为异动数据.</p>

<p><img src="https://raw.githubusercontent.com/3xp10it/pic/master/dxjl_v39.png" data-action="zoom" /></p>

<p>关键函数1的参数如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>void __thiscall sub_D2FDF0(char *this, int a2, int a3, COLORREF color, int a5, int a6, int a7, int a8)
</code></pre>
</div>

<p>现在需要弄清楚关键函数1的这些参数是怎样”变”出v39的,经过静态猜测分析和动态调试验证,最终得出如下结论:</p>

<p>thiscall函数的this指针保存在ecx寄存器中,<code class="highlighter-rouge">v55=this+2672+32=this+2704,v21=[[v55]+8*v13],v39=[v21+4/8/12/16]</code>,<code class="highlighter-rouge">*[v39]</code>为异动消息内容,关键函数1的第1个参数(非this指针)args[0]是index值(在短线精灵消息显示界面每条消息有个index,代表当前界面的第几条消息),<code class="highlighter-rouge">[[[v55]+8*args[0]]+4]</code>是异动消息中的股票名对应的地址,<code class="highlighter-rouge">[[[v55]+8*args[0]]+8]</code>是异动消息中的时间值对应的地址,<code class="highlighter-rouge">[[[v55]+8*args[0]]+12]</code>是异动消息中的异动类型对应的地址,<code class="highlighter-rouge">[[[v55]+8*args[0]]+16]</code>是异动消息中的异动类型值对应的地址.于是可构建如下代码进行异动消息显示hook:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>from __future__ import print_function
import frida
import sys

def get_string_from_js(source):
    result_bytes=b''
    for v in source.split(","):
        if v=='0':
            break
        result_bytes+=int(v).to_bytes(1,'little')
    return result_bytes.decode('gbk')
def on_message(message, data):
    #print("[%s] =&gt; %s" % (message, data))
    action=message['payload']['result']['action']
    action_bytes=b''
    for v in action.split(","):
        if v=='0':
            break
        action_bytes+=int(v).to_bytes(1,'little')
    action=action_bytes.decode('gbk')
    
    
    result=message['payload']['result']
    timestamp=result['timestamp']
    stock_name=result['stock_name']
    stock_name=get_string_from_js(stock_name)
    action_value=result['action_value']
    action_value=get_string_from_js(action_value)
    print(timestamp+"    "+stock_name+"    "+action+"    "+action_value)
    

def main(target_process):
    session = frida.attach(target_process)

    script = session.create_script("""
    // Find base address of current imported jvm.dll by main process fledge.exe
    var baseAddr = Module.findBaseAddress('%s');
    console.log('%s baseAddr: ' + baseAddr);

    var testfunc = ptr('0xd2fdf0'); // Here we use the function address as seen in our disassembler

    Interceptor.attach(testfunc, {
        onEnter: function (args) {
            console.log('[+] Called ' + testfunc);
            //addr.readPointer()是获取addr位置中的4字节内容,也即[addr],如果addr位置的内存16进制值为53 62 12 15,则结果值为0x15126253,类型为指针
            //thiscall函数的this指针保存在ecx寄存器中,v55=this+2672+32=this+2704,v21=[[v55]+8*v13],v39=[v21+4/8/12/16],*[v39]为内容
            //index=args[0]
            //address1=[[[v55]+8*args[0]]+4],content1=*address1,是address1位置处的字符串
            //address2=[[[v55]+8*args[0]]+8],content2=*address2,是address2位置处的字符串
            //address3=[[[v55]+8*args[0]]+12],content3=*address3,是address3位置处的字符串
            //address4=[[[v55]+8*args[0]]+16],content4=*address4,是address4位置处的字符串
            //console.log(this.context.ecx.add(2704).readPointer())
            var v55_v=this.context.ecx.add(2704).readPointer()
            
            var stock_name=v55_v.add(8*args[0]).readPointer().add(4).readPointer().readByteArray(8)           
            var timestamp=v55_v.add(8*args[0]).readPointer().add(8).readPointer().readCString()
            var action=v55_v.add(8*args[0]).readPointer().add(12).readPointer().readByteArray(10)   
            var action_value=v55_v.add(8*args[0]).readPointer().add(16).readPointer().readByteArray(6)
         
            var stock_name=(new Uint8Array(stock_name)).toString()
            var action=(new Uint8Array(action)).toString()
            var action_value=(new Uint8Array(action_value)).toString()

            var item_dict={}
            item_dict['stock_name']=stock_name
            item_dict['timestamp']=timestamp
            item_dict['action']=action
            item_dict['action_value']=action_value
            send({'result':item_dict})
  
        },


        onLeave: function (retval) {

            //console.log('[+] Returned from testfunc: ' + retval);
        }
    });

    function read_addr_string(addr,length,encoding) {
        var bytes_array_value=new Uint8Array(addr.readByteArray(length))
        console.log(bytes_array_value)
        console.log(888)
        let _str = new TextDecoder('gbk').decode(bytes_array_value);
        console.log(_str)
        console.log(111)
        var hex_str=""
        for (var i=0;i&lt;bytes_array_value.length;i++)
        {
            hex_str+=bytes_array_value[i].toString(16)+" "
        }
    }

    function dumpAddr(info, addr, size) {
        if (addr.isNull())
            return;

        console.log('Data dump ' + info + ' :');
        var buf = addr.readByteArray(size);

        // If you want color magic, set ansi to true
        //console.log(hexdump(buf, { offset: 0, length: size, header: true, ansi: false }));
        console.log(hexdump(buf, { offset: 0, length: size, header: true, ansi: false }));
    }


""" % (target_process,target_process))
    script.on('message', on_message)
    script.load()
    print("[!] Ctrl+D on UNIX, Ctrl+Z on Windows/cmd.exe to detach from instrumented program.\n\n")
    sys.stdin.read()
    session.detach()

if __name__ == '__main__':
    target_process = "hexin.exe"
    main(target_process)
</code></pre>
</div>
</span>

        


        
        <div class="tags">
          <small>
          <i class="fa fa-tags"></i>
            炒股
          </small>
        </div>
        

      </div>

      


<!-- 个人增加织网背景效果 -->
<!--
<script type="text/javascript" color="255,255,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
-->


      



      


      

    </div>

  </div>

</div>




      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-12">
		  <!--for better experience please install font 文泉驿等宽正黑-->
Since March 2016 the 3xp10it.cc has been running  <span id="times" style="align: center no:1px solid black"></span><br />
	<SCRIPT language=javascript> 
	<!-- 
	function show_date_time(){ 
		window.setTimeout("show_date_time()", 1000); 
		BirthDay=new Date("3/7/2016 20:00:00");
		today=new Date(); 
		timeold=(today.getTime() - BirthDay.getTime()); 
		sectimeold=timeold/1000 
		secondsold=Math.floor(sectimeold); 
		msPerDay=24*60*60*1000 
		e_daysold=timeold/msPerDay 
		daysold=Math.floor(e_daysold); 
		e_hrsold=(e_daysold-daysold)*24; 
		hrsold=Math.floor(e_hrsold); 
		e_minsold=(e_hrsold-hrsold)*60; 
		minsold=Math.floor((e_hrsold-hrsold)*60); 
		seconds=Math.floor((e_minsold-minsold)*60); 
		//times = document.getElementById("times");
		times.innerHTML="<span>"+daysold+ "days " +hrsold+"hours "+minsold+"minutes"+seconds+"seconds"+"</span>" ; 
	} 
	show_date_time(); 
	//--> 
	</SCRIPT>
  </div>
</div>

<div class="my-home"><i class="fa fa-home" aria-hidden="true"></i><a href="/index2.html"> <font color="white">home</font></a></div>
<div class="my-papers"><i class="fa fa-github" aria-hidden="true"></i><a href="https://github.com/3xp10it" target="_top"> <font color="white">github</font></a></div>
<div class="my-search"><i class="fa fa-search" aria-hidden="true"></i><a href="/search/"> <font color="white">search</font></a></div>
<div class="my-archive"><i class="fa fa-folder" aria-hidden="true"></i><a href="/my-archive/"> <font color="white">archive</font></a></div>
<div class="my-categories"><i class="fa fa-apple" aria-hidden="true"></i><a href="/my-categories/"> <font color="white">category</font></a></div>


<script src="/js/jquery-1.11.0.min.js"></script>
<!--
<script src="/js/bootstrap.min.js"></script>
-->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>





<!--
<script type="text/javascript"> 
$youziku.load("h1,h2,h3,h4,h5,h6,code,.content,.content-panel,.gravatar,pre,body", "354f6990dc1b43608d3eb96d50273504", "WenQuanYi_Zen_Hei_Mono");
$youziku.draw(); 
</script>
-->


    </body>
</html>
