---
layout:     post
title:      ios tweakåˆ¶ä½œ
date:       2017-11-06
summary:    ios tweakåˆ¶ä½œ
categories: äºŒè¿›åˆ¶
tags:
 - ios
 - tweak
 - lldb
---

### 0x00 å·¥å…·å‡†å¤‡

1.tweakåˆ¶ä½œå·¥å…·(æ¡†æ¶):[theos][1]

2.ios appè„±appstoreåŠ çš„å£³å·¥å…·:[cluth][2]

3.ios appå¤´æ–‡ä»¶æå–å·¥å…·:[class-dump][3]

4.class-dumpçš„swift+object cä¸æŠ¥é”™ç‰ˆæœ¬:[é¡¹ç›®åœ°å€][4],[å¯æ‰§è¡Œæ–‡ä»¶][5]

5.æŸ¥çœ‹è¿è¡Œæ—¶å‡½æ•°è°ƒç”¨åŠè°ƒç”¨å‚æ•°å€¼å·¥å…·:logify.pl,logifyæ˜¯theosçš„ä¸€ä¸ªå†…ç½®å·¥å…·,è·¯å¾„ä¸º/opt/theos/bin/logify.pl

6.è¿œç¨‹è°ƒè¯•ioså·¥å…·:debugserver+lldb+[ida pro]

7.æŸ¥çœ‹ios appä¸­çš„uiå¯¹åº”çš„ç±»çš„å·¥å…·(å®‰è£…åœ¨æ‰‹æœºä¸Š):flex_injected[6]

### 0x01 tweakåˆ¶ä½œå®ä¾‹

#### å®ç°ä¸€ä¸ªappä¸Šä¼ æ­¥æ•°å¤§äº5000

```
ssh root@iphone.ip
wget https://github.com/KJCracks/Clutch/releases/download/2.0.4/Clutch-2.0.4 -O /usr/bin/Cluth
Cluth -i
Cluth -d index_number_of_target_app
scp output.ipa user@pc_ip:
exit
extract the executable mach-o target file from ~/output.ipa to ~/output
class-dump -H ~/output -o ~/output_header
åˆ†æå‡ºå¯ç–‘ç±»ä¸­çš„å‡½æ•°ä¸ºPARSPedometerInfo.hä¸­çš„å‡½æ•°[ç»“åˆflex_injected,ida pro,frida,logify.plå¾—å‡º]
nic.pl
é€‰æ‹©æ–°å»ºä¸€ä¸ªiphone tweak,é¡¹ç›®ç›®å½•ä¸º~/xupload
è®¾ç½®MobileSubstrate Bundle filterçš„å€¼ä¸ºoutput.ipaçš„bundleidçš„å€¼,å¯ä»output.ipaçš„info.plistä¸­å¾—åˆ°
logify.pl ~/output_header/PARSPedometerInfo.h > ~/xupload/Tweak.xm[è¿™ä¸€æ­¥æ˜¯ä¸ºäº†hookå¯ç–‘å‡½æ•°,æŸ¥çœ‹è°ƒç”¨åŠå‚æ•°]
cd xupload
make
make package
scp package/xxxx.deb root@iphone.ip:
ssh root@iphone.ip
dpkg -i xxxx.deb
æ‰‹æœºè¿æ¥mac,æ‰“å¼€xcode,åœ¨windows|device and simulators|ç‚¹å‡»æŸ¥çœ‹logæŒ‰é’®(å°ä¸‰è§’å½¢çŠ¶)
è¿è¡Œç›®æ ‡appå¹¶ç‚¹å‡»ä¸Šä¼ æ­¥æ•°
æŸ¥çœ‹xcodeä¸­å‡½æ•°çš„è°ƒç”¨æ—¥å¿—å¦‚ä¸‹
```

```
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:20[m [0;30;46mDEBUG:[m  = PARSPedometerInfo<0x1708d8f70>: 
	 integration=0 
	 iPhone=0 
	 watch=0 
	 heartRat=0
	 at:2017-11-05 16:00:00 +0000
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:21[m [0;30;46mDEBUG:[m  = PARSPedometerInfo<0x1708d8f70>: 
	 integration=0 
	 iPhone=0 
	 watch=0 
	 heartRat=0
	 at:2017-11-05 16:00:00 +0000
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:12[m [0;30;46mDEBUG:[m -[<PARSPedometerInfo: 0x1708d8f70> setIntegratedSteps:36]
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:8[m [0;30;46mDEBUG:[m -[<PARSPedometerInfo: 0x1708d8f70> setStartDate:2017-11-04 16:00:00 +0000]
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:21[m [0;30;46mDEBUG:[m -[<PARSPedometerInfo: 0x174ad8100> init]
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:20[m [0;30;46mDEBUG:[m -[<PARSPedometerInfo: 0x174ad8100> description]
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:20[m [0;30;46mDEBUG:[m  = PARSPedometerInfo<0x174ad8100>: 
	 integration=0 
	 iPhone=0 
	 watch=0 
	 heartRat=0
	 at:2017-11-05 16:00:00 +0000
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:21[m [0;30;46mDEBUG:[m  = PARSPedometerInfo<0x174ad8100>: 
	 integration=0 
	 iPhone=0 
	 watch=0 
	 heartRat=0
	 at:2017-11-05 16:00:00 +0000
Nov  6 12:05:32 iPhone PALifeApp[4494] <Notice>: [1;36m[xupload] [m[0;36mTweak.xm:12[m [0;30;46mDEBUG:[m -[<PARSPedometerInfo: 0x174ad8100> setIntegratedSteps:2305]
```

ä»ä¸Šé¢æ—¥å¿—ä¸­å‘ç°å…³é”®å‡½æ•°åŠå‚æ•°setIntegratedSteps:2305,äºæ˜¯è¦hookè¿™ä¸ªå‡½æ•°å¹¶è®¾ç½®å‚æ•°ä¸ºå¤§äº5000çš„å€¼.
å›åˆ°Tweak.xmä¸­æŸ¥çœ‹è¿™ä¸ªå‡½æ•°

```
- (void)setIntegratedSteps:(long long )integratedSteps { %log; %orig; }
```

ä»ä¸­çœ‹å‡ºsetIntergratedStepså‡½æ•°ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°,å‚æ•°ç±»å‹æ˜¯long long,è¿™ä¹Ÿæ˜¯ä¸€ç§intç±»å‹,å¤§å°èŒƒå›´æ˜¯intç±»å‹çš„4å€,ç›´æ¥ä¿®æ”¹
æˆ

```
%hook PARSPedometerInfo
- (void)setIntegratedSteps:(long long )integratedSteps { %log; %orig(15347);  }
%end
```

```
make clean
make 
make package
scp packages/xxx.deb root@iphone.ip:
ssh root@iphone.ip
dpkg -P com.yourcompany.xupload
dpkg -i xxx.deb
```

é‡æ–°è¿è¡Œç›®æ ‡appå¹¶ç‚¹å‡»ä¸Šä¼ æ­¥æ•°,æˆåŠŸä¸Šä¼ ,åæ¥åˆ†æä¸Šé¢setIntegratedStepså‡½æ•°è°ƒç”¨çš„å‚æ•°ä¸ºintegratedStepså‡½æ•°,ä¹Ÿå³
integratedStepså‚æ•°çš„è¿”å›å€¼ä½œä¸ºsetIntegratedStepså‡½æ•°çš„å‚æ•°,ä¹Ÿå³åŒæ ·å¯é€šè¿‡hook integratedStepså‡½æ•°æ¥å®ç°,åˆ†æè®¤ä¸º
integratedStepså‡½æ•°æ˜¯è·å–æœ¬åœ°çš„æ­¥æ•°å€¼,è€ŒsetIntegratedStepså‡½æ•°æ˜¯ä¸Šä¼ æœ¬åœ°æ­¥æ•°.hook integratedStepså‡½æ•°å¯å¦‚ä¸‹ä¿®æ”¹
```
å°†
- (long long )integratedSteps { %log; long long  r = %orig; HBLogDebug(@" = %lld", r); return r; }
ä¿®æ”¹ä¸º:

- (long long )integratedSteps { %log; long long  r =15347; return r; }
```


[1]: https://github.com/theos/theos
[2]: https://github.com/theos/theos
[3]: https://github.com/nygard/class-dump
[4]: https://github.com/BlueCocoa/class-dump
[5]: https://github.com/3xp10it/mytools/blob/master/class-dump
[6]: https://github.com/dtrukr/FLEX_injected
