---
layout:     post
title:      确立头寸规模和设置止损
date:       2018-12-05
summary:    确立头寸规模和设置止损
categories: 炒股
tags:
 - 头寸规模
 - 止损
---

### 0x1 About

书中指出一个交易系统重要性排序为:

`头寸规模>买点>卖点`

本文介绍头寸规模和止损点的关系,这里的止损指卖出点,包括盈利时的卖出和亏损时的卖出

### 0x2 ATR

ATR基础知识可参考[这里][1]和[这里][2],通过前面链接中ATR指标的认识可知:

+ ATR是较科学的止损方案
+ ATR可用于确立头寸规模和设置止损

实际回测ATR跟踪止损时,笔者也发现ATR有较好的风险控制能力,只回测波动性强(不规则)的股票也能保持总的收益为正,这点与百分比跟踪止损相比显露出了明显的优势(使用百分比跟踪止损时只回测波动性强的股票时总的收益为负)


### 0x3 确立头寸规模和设置止损

#### 0xa 风险与收益成正比

经过多次回测与书籍的知识得知:风险与收益成正比
风险可用最大回撤来表示,假如单笔交易最大回撤为5%,单笔交易最大盈利为20%,同一个买入策略情况下,将止损点调到允许回撤为10%,则单笔交易会比20%高,如30%.如下数据示例:

``````
SH.600270 单笔最大回撤13%,单笔最大盈利35%
good buy point:
2007-08-10    -5.1%    34.4%
2007-12-21    2.8%    1.1%
2009-07-10    0.7%    0.5%
2011-02-11    0.8%    19.6%
2013-05-24    1.2%    20.7%
2014-02-14    4.5%    6.8%
2014-08-08    2.6%    4.1%
2014-09-05    0.4%    17.9%
2015-03-13    2.9%    35.6%
2015-05-22    4.9%    11.0%
2017-08-04    2.2%    0.4%
bad buy point:
2010-01-15    -1.9%    -5.9%
2010-04-02    -0.4%    -5.4%
2010-11-05    0.7%    -6.8%
2013-03-22    1.3%    -8.2%
2013-08-02    -0.9%    -5.4%
2013-08-30    1.1%    -10.2%
2013-10-11    12.9%    -4.7%
2014-04-11    -3.7%    -13.0%
2014-07-04    -0.4%    -7.0%
2014-10-31    6.2%    -11.4%
2014-12-19    -0.6%    -8.8%
2015-01-09    3.8%    -5.7%
2015-01-23    -0.9%    -9.2%
2015-08-14    0.3%    -9.6%
2017-10-27    -0.2%    -3.8%
盈利11次,亏损15次,总收益36926
``````
``````

SH.600270 单笔最大回撤26%,单笔最大盈利58%

good buy point:
2007-08-10    -5.1%    16.4%
2009-07-10    0.7%    0.5%
2011-02-11    0.8%    10.7%
2013-05-24    1.2%    24.1%
2013-08-02    -0.9%    58.1%
2014-02-14    4.5%    16.7%
2014-08-08    2.6%    39.0%
2014-12-19    -0.6%    44.0%
2017-08-04    2.2%    0.4%
bad buy point:
2007-12-21    2.8%    -6.4%
2010-01-15    -1.9%    -13.0%
2010-04-02    -0.4%    -5.4%
2010-11-05    0.7%    -14.7%
2013-03-22    1.3%    -12.3%
2014-07-04    -0.4%    -10.3%
2015-05-22    4.9%    -11.6%
2015-08-14    0.3%    -26.2%
2017-10-27    -0.2%    -5.4%
盈利9次,亏损9次,总收益104223
``````

从上面数据看出,相同买入策略下,最大回撤越小则单笔最大盈利越小,一般也对应着总收益越小,体现出"风险与收益成正比",也即:

`一般情况下,单笔最大回撤越大则总收益越大`

#### 0xb 头寸规模与止损的关系

止损点(允许的最大回撤)控制着每笔交易的风险,而头寸规模的大小控制着全部资金的风险.

如果使用百分比止损,并允许单笔交易最大亏损为10%,则头寸大小的计算如下(一般考虑以总资金的1%为风险资金):

`总资金*1%=单笔交易的10%亏损`

例如某个股的价格是30元/股,总资金为10w,允许单笔最大亏损为10%,则头寸规模计算结果如下:

`100000*1%/0.1/30=333股,也即买入这支股票时,总共应该买入333股,头寸资金=333*30=9990`

ATR止损比百分比止损更好,ATR止损一般采用距买入后最高收盘价3个ATR的的价格跟踪止损卖出,可以想象到,这种情况下最大的回撤为距买入价格3个ATR的价位处,因为最坏的情况是买入点是最高点(买在了最高点),从买入点第2天开始后股价一路下跌并到达距离买入点3个ATR止损处被止损退出,这种情况下头寸规模计算如下:

`总资金*1%=单笔交易的3个ATR亏损`

例如某个股的当前价格是30元/股,且满足买点要求,且买在了最高点,买点的ATR的值为2,也即到了28元就要止损,则头寸规模计算结果如下:

`100000*1%/(3*2)=167股,头寸资金=167*30=5010`

#### 0xc 总结方案

在上面的回测数据中,如果为了降低风险而把单笔交易的最大回撤调小,这样一般情况下(策略总期望收益为正的系统)总收益也会减小,但是更安全,但还是收益少.为了既满足收益多又减小风险可通过调整头寸资金量实现:
例如,将前面的原来的风险资金为资金的1%调整成总资金的0.3%并设置单笔最大回撤为6个ATR来进行跟踪止损,在相同条件下,ATR止损的头寸规模计算如下:
``````
总资金*0.3%=单笔交易的6个ATR亏损
100000*0.3%/(6*2)=25股,头寸资金=25*30=750
``````
也即,可通过减小单笔头寸资金量来弥补最大回撤的风险,通过减小单笔头寸资金来增大单笔最大回撤,从而达到"风险和收益成正比"来实现"更大风险"下的更多收益,并如下计算头寸规模(根据个人不同情况自由设置x)来建仓:

`总资金*x=单笔交易的y个ATR亏损`



[1]: https://www.ricequant.com/community/topic/1422//21
[2]: http://www.360doc.com/content/14/1202/00/628324_429724154.shtml
