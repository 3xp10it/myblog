---
layout:     post
title:      实战ios破解--通过UI找关键函数
date:       2018-01-16
summary:    实战ios破解--通过UI找关键函数
categories: 二进制
tags:
 - ios
 - UI
 - cycript
---

### 0x0 About

本文记录破解一个cydia中收费deb软件过程,如下为一个截图,其中`权限`所在UI显示`未授权`

![权限截图][1]

### 0x1 通过UI找函数的2种方法

+ ios通过cydia安装`flex_injected`,并在要破解的软件中使用`flex_injected`
这种方法很方便,效率很高,可通过点击app中的`flex_injected`功能区的`select`,再点击对应UI再点击`views`按钮,通过`views`中的不同颜色来直接定位对应UI和UI对应的类

+ 通过cycript注入要破解的软件,然后通过`[#0x... setHidden:YES]`来找到UI后再找函数
这种方法比上面的方法麻烦,需要通过[这里][2]的命令来查找,一般是通过`[[UIApp keyWindow] recursiveDescription]`得到的结果逐个元素进行排除来得到目标UI对象.有以下2点注意事项
    + cycript设置查看ui对应函数时用到的?expand命令失效时可以这样弥补`[[UIApp keyWindow] recursiveDescription].toString()`
    + cycript查找ui对应的元素可通过找几个主要的大树枝,如果大树枝`[#0x... setHidden:YES]`后发现要找的UI不显示了则说明要找的UI在这个大树枝里面,然后再大树枝里通过`[#0x... setHidden:YES]`逐渐找到最终的小树枝.通过cycript找UI这条路一般不用,除非用flex_injected找不到(有些app无法使用flex_injected) 

### 0x2 破解过程

#### step1 找到ui对应的元素

本文要破解的app是cydia里安装的,可能有一些反破解机制,导致无法直接使用`ida`调试,也无法使用`flex_injected`分析ui,于是使用上面的第2种方法,也即通过`cycript`注入目标进程来通过排除法查找上图中`权限`这个ui对应的函数


#### step2 找到ui元素对应的函数


#### step3 ida分析函数

[1]: https://raw.githubusercontent.com/3xp10it/pic/master/crack_deb.png
[2]: https://www.jianshu.com/p/e802b8b76e92
